{"version":3,"file":"static/webpack/static/development/pages/_app.js.64b34b1709110efe870e.hot-update.js","sources":["webpack:///./lib/initApollo.ts"],"sourcesContent":["import {\n  ApolloClient,\n  InMemoryCache,\n  NormalizedCacheObject\n} from \"apollo-boost\";\nimport { createHttpLink } from \"apollo-link-http\";\nimport { setContext } from \"apollo-link-context\";\nimport fetch from \"isomorphic-unfetch\";\nimport { isBrowser } from \"./isBrowser\";\n\nlet apolloClient: ApolloClient<NormalizedCacheObject> | null = null;\n\nif (!isBrowser) {\n  (global as any).fetch = fetch;\n}\n\ninterface Options {\n  getToken: () => string;\n}\n\nfunction create(initialState: any, { getToken }: Options) {\n  const httpLink = createHttpLink({\n    uri: \"http://localhost:4000/graphql\",\n    credentials: \"include\"\n  });\n\n  const authLink = setContext((_, { headers }) => {\n    const token = getToken();\n    return {\n      headers: {\n        ...headers,\n        cookie: token ? `qid=${token}` : \"\"\n      }\n    };\n  });\n\n  return new ApolloClient({\n    connectToDevTools: isBrowser,\n    ssrMode: !isBrowser,\n    link: authLink.concat(httpLink),\n    cache: new InMemoryCache().restore(initialState || {})\n  });\n}\n\nexport default function initApollo(initialState: any, options: Options) {\n  if (!isBrowser) {\n    return create(initialState, options);\n  }\n\n  if (!apolloClient) {\n    apolloClient = create(initialState, options);\n  }\n\n  return apolloClient;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AAKA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAKA;AAAA;AACA;AACA;AACA;AAFA;AAKA;AAAA;AACA;AACA;AACA;AAEA;AAFA;AADA;AAMA;AAEA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;A","sourceRoot":""}